import { expect } from "chai";
import "mocha";
import { mergeFragments } from "../src/lib/client/Fragments/FragmentMerger";
import { fragmentalise } from "../src/lib/client/Fragments/Fragmentaliser";
import { deserialise } from "../src/lib/client/serialisation/Deserialisation";
import { serialise } from "../src/lib/client/serialisation/Serialisation";

describe("FragmentMerger", () => {

    it("fragmentList from server and subsequent merge should recreate bean from server", () => {

        const bean0Json = "{\"longVar\":7,\"boolVar\":false,\"intVar\":6,\"arrayLongVar\":[\"_array\",13,14],\"arrayFloatVar\":[\"_array\",17.0,18.0],\"mapStringVar\":[\"_map\",[\"key1\",\"value1\"],[\"key0\",\"value0\"]],\"setLongVar\":[\"_set\",13,14],\"setFloatVar\":[\"_set\",18.0,17.0],\"beanVar\":{\"standardEnumVar\":\"ONE\",\"stringVar\":\"5string\",\"longVar\":2,\"doubleVar\":3.0,\"floatVar\":4.0,\"_t\":\"TestBean1\",\"boolVar\":true,\"intVar\":1,\"stringEnumVar\":\"tHree\",\"integerEnumVar\":2},\"arrayBeanVar0\":[\"_array\",{\"stringVar\":\"string21\",\"_t\":\"TestBean2\",\"arrayStringVar\":[\"_array\",\"stringa\",\"stringb\"],\"mapStringVar\":[\"_map\",[\"key_b\",\"value_b\"],[\"key_a\",\"value_a\"]]},{\"stringVar\":\"string22\",\"_t\":\"TestBean2\",\"arrayStringVar\":[\"_array\",\"stringa\",\"stringc\",\"stringd\"],\"mapStringVar\":[\"_map\",[\"key_b\",\"value_b\"],[\"key_a\",\"value_a\"]]}],\"arrayBeanVar1\":[\"_array\",{\"stringVar\":\"string21\",\"_t\":\"TestBean2\",\"arrayStringVar\":[\"_array\",\"stringa\",\"stringb\"],\"mapStringVar\":[\"_map\",[\"key_b\",\"value_b\"],[\"key_a\",\"value_a\"]]}],\"setIntegerVar\":[\"_set\",11,12],\"setDoubleVar\":[\"_set\",16.0,15.0],\"standardEnumVar\":\"ONE\",\"stringVar\":\"10string\",\"doubleVar\":8.0,\"floatVar\":9.0,\"arrayIntegerVar\":[\"_array\",11,12],\"setStringVar\":[\"_set\",\"string20\",\"string19\"],\"stringEnumVar\":\"tHree\",\"mapBeanVar\":[\"_map\",[\"key1\",{\"stringVar\":\"string22\",\"_t\":\"TestBean2\",\"arrayStringVar\":[\"_array\",\"stringa\",\"stringc\",\"stringd\"],\"mapStringVar\":[\"_map\",[\"key_b\",\"value_b\"],[\"key_a\",\"value_a\"]]}],[\"key0\",{\"stringVar\":\"string21\",\"_t\":\"TestBean2\",\"arrayStringVar\":[\"_array\",\"stringa\",\"stringb\"],\"mapStringVar\":[\"_map\",[\"key_b\",\"value_b\"],[\"key_a\",\"value_a\"]]}]],\"arrayBooleanVar\":[\"_array\",true,false],\"setBooleanVar\":[\"_set\",false,true],\"_t\":\"TestBean0\",\"arrayStringVar\":[\"_array\",\"string19\",\"string20\"],\"beanVar3\":{\"standardEnumVar\":\"ONE\",\"stringVar\":\"5string\",\"longVar\":2,\"doubleVar\":3.0,\"floatVar\":4.0,\"_t\":\"TestBean1\",\"boolVar\":true,\"intVar\":1,\"stringEnumVar\":\"tHree\",\"integerEnumVar\":2},\"arrayDoubleVar\":[\"_array\",15.0,16.0],\"beanVar2\":{\"standardEnumVar\":null,\"stringVar\":null,\"longVar\":null,\"doubleVar\":null,\"floatVar\":null,\"_t\":\"TestBean1\",\"boolVar\":null,\"intVar\":null,\"stringEnumVar\":null,\"integerEnumVar\":null},\"integerEnumVar\":2}";
        const bean1Json = "{\"longVar\":8,\"boolVar\":true,\"intVar\":7,\"arrayLongVar\":[\"_array\",12,14],\"arrayFloatVar\":[\"_array\",16.0,18.0],\"mapStringVar\":[\"_map\",[\"key1\",\"value1\"],[\"key2\",\"value2\"]],\"setLongVar\":[\"_set\",14],\"setFloatVar\":[\"_set\",16.0,18.0],\"beanVar\":{\"standardEnumVar\":\"TWO\",\"stringVar\":\"6string\",\"longVar\":3,\"doubleVar\":4.0,\"floatVar\":5.0,\"_t\":\"TestBean1\",\"boolVar\":false,\"intVar\":2,\"stringEnumVar\":\"oNe\",\"integerEnumVar\":3},\"arrayBeanVar0\":[\"_array\",{\"stringVar\":\"string20\",\"_t\":\"TestBean2\",\"arrayStringVar\":[\"_array\",\"stringc\",\"stringc\",\"stringd\"],\"mapStringVar\":[\"_map\",[\"key_c\",\"value_c\"],[\"key_b\",\"value_b\"]]}],\"arrayBeanVar1\":[\"_array\",{\"stringVar\":\"string21\",\"_t\":\"TestBean2\",\"arrayStringVar\":[\"_array\",\"stringa\"],\"mapStringVar\":[\"_map\",[\"key_b\",\"value_b\"]]},{\"stringVar\":\"string21\",\"_t\":\"TestBean2\",\"arrayStringVar\":[\"_array\",\"stringa\"],\"mapStringVar\":[\"_map\",[\"key_b\",\"value_b\"]]}],\"setIntegerVar\":[\"_set\",12],\"setDoubleVar\":[\"_set\",16.0,15.0],\"standardEnumVar\":null,\"stringVar\":\"11string\",\"doubleVar\":9.0,\"floatVar\":10.0,\"arrayIntegerVar\":[\"_array\",10,12],\"setStringVar\":[\"_set\",\"string20\"],\"stringEnumVar\":null,\"mapBeanVar\":[\"_map\",[\"key1\",{\"stringVar\":\"string21\",\"_t\":\"TestBean2\",\"arrayStringVar\":[\"_array\",\"stringa\"],\"mapStringVar\":[\"_map\",[\"key_b\",\"value_b\"]]}],[\"key2\",{\"stringVar\":\"string20\",\"_t\":\"TestBean2\",\"arrayStringVar\":[\"_array\",\"stringc\",\"stringc\",\"stringd\"],\"mapStringVar\":[\"_map\",[\"key_c\",\"value_c\"],[\"key_b\",\"value_b\"]]}]],\"arrayBooleanVar\":[\"_array\",false,false],\"setBooleanVar\":[\"_set\",false],\"_t\":\"TestBean0\",\"arrayStringVar\":[\"_array\",\"string18\",\"string20\"],\"beanVar3\":{\"standardEnumVar\":null,\"stringVar\":null,\"longVar\":null,\"doubleVar\":null,\"floatVar\":null,\"_t\":\"TestBean1\",\"boolVar\":null,\"intVar\":null,\"stringEnumVar\":null,\"integerEnumVar\":null},\"arrayDoubleVar\":[\"_array\",14.0,16.0],\"beanVar2\":{\"standardEnumVar\":\"ONE\",\"stringVar\":\"5string\",\"longVar\":2,\"doubleVar\":3.0,\"floatVar\":4.0,\"_t\":\"TestBean1\",\"boolVar\":true,\"intVar\":1,\"stringEnumVar\":\"tHree\",\"integerEnumVar\":2},\"integerEnumVar\":null}";
        const fragmentListJson = "{\"_t\":\"FragmentList\",\"fragments\":[\"_array\",{\"path\":[\"_array\",\"longVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"8\",\"type\":\"m\"},{\"path\":[\"_array\",\"boolVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"true\",\"type\":\"m\"},{\"path\":[\"_array\",\"intVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"7\",\"type\":\"m\"},{\"path\":[\"_array\",\"arrayLongVar\",\"0\"],\"_t\":\"Fragment\",\"jsonPayload\":\"12\",\"type\":\"m\"},{\"path\":[\"_array\",\"arrayFloatVar\",\"0\"],\"_t\":\"Fragment\",\"jsonPayload\":\"16.0\",\"type\":\"m\"},{\"path\":[\"_array\",\"mapStringVar\",\"key0\"],\"_t\":\"Fragment\",\"jsonPayload\":null,\"type\":\"r\"},{\"path\":[\"_array\",\"mapStringVar\",\"key2\"],\"_t\":\"Fragment\",\"jsonPayload\":\"\\\"value2\\\"\",\"type\":\"c\"},{\"path\":[\"_array\",\"setLongVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"[\\\"_set\\\",14]\",\"type\":\"m\"},{\"path\":[\"_array\",\"setFloatVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"[\\\"_set\\\",16.0,18.0]\",\"type\":\"m\"},{\"path\":[\"_array\",\"beanVar\",\"standardEnumVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"\\\"TWO\\\"\",\"type\":\"m\"},{\"path\":[\"_array\",\"beanVar\",\"stringVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"\\\"6string\\\"\",\"type\":\"m\"},{\"path\":[\"_array\",\"beanVar\",\"longVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"3\",\"type\":\"m\"},{\"path\":[\"_array\",\"beanVar\",\"doubleVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"4.0\",\"type\":\"m\"},{\"path\":[\"_array\",\"beanVar\",\"floatVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"5.0\",\"type\":\"m\"},{\"path\":[\"_array\",\"beanVar\",\"boolVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"false\",\"type\":\"m\"},{\"path\":[\"_array\",\"beanVar\",\"intVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"2\",\"type\":\"m\"},{\"path\":[\"_array\",\"beanVar\",\"stringEnumVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"\\\"oNe\\\"\",\"type\":\"m\"},{\"path\":[\"_array\",\"beanVar\",\"integerEnumVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"3\",\"type\":\"m\"},{\"path\":[\"_array\",\"arrayBeanVar0\",\"0\",\"stringVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"\\\"string20\\\"\",\"type\":\"m\"},{\"path\":[\"_array\",\"arrayBeanVar0\",\"0\",\"arrayStringVar\",\"0\"],\"_t\":\"Fragment\",\"jsonPayload\":\"\\\"stringc\\\"\",\"type\":\"m\"},{\"path\":[\"_array\",\"arrayBeanVar0\",\"0\",\"arrayStringVar\",\"1\"],\"_t\":\"Fragment\",\"jsonPayload\":\"\\\"stringc\\\"\",\"type\":\"m\"},{\"path\":[\"_array\",\"arrayBeanVar0\",\"0\",\"arrayStringVar\",\"2\"],\"_t\":\"Fragment\",\"jsonPayload\":\"\\\"stringd\\\"\",\"type\":\"c\"},{\"path\":[\"_array\",\"arrayBeanVar0\",\"0\",\"mapStringVar\",\"key_a\"],\"_t\":\"Fragment\",\"jsonPayload\":null,\"type\":\"r\"},{\"path\":[\"_array\",\"arrayBeanVar0\",\"0\",\"mapStringVar\",\"key_c\"],\"_t\":\"Fragment\",\"jsonPayload\":\"\\\"value_c\\\"\",\"type\":\"c\"},{\"path\":[\"_array\",\"arrayBeanVar0\",\"1\"],\"_t\":\"Fragment\",\"jsonPayload\":null,\"type\":\"r\"},{\"path\":[\"_array\",\"arrayBeanVar1\",\"0\",\"arrayStringVar\",\"1\"],\"_t\":\"Fragment\",\"jsonPayload\":null,\"type\":\"r\"},{\"path\":[\"_array\",\"arrayBeanVar1\",\"0\",\"mapStringVar\",\"key_a\"],\"_t\":\"Fragment\",\"jsonPayload\":null,\"type\":\"r\"},{\"path\":[\"_array\",\"arrayBeanVar1\",\"1\"],\"_t\":\"Fragment\",\"jsonPayload\":\"{\\\"stringVar\\\":\\\"string21\\\",\\\"_t\\\":\\\"TestBean2\\\",\\\"arrayStringVar\\\":[\\\"_array\\\",\\\"stringa\\\"],\\\"mapStringVar\\\":[\\\"_map\\\",[\\\"key_b\\\",\\\"value_b\\\"]]}\",\"type\":\"c\"},{\"path\":[\"_array\",\"setIntegerVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"[\\\"_set\\\",12]\",\"type\":\"m\"},{\"path\":[\"_array\",\"standardEnumVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"null\",\"type\":\"m\"},{\"path\":[\"_array\",\"stringVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"\\\"11string\\\"\",\"type\":\"m\"},{\"path\":[\"_array\",\"doubleVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"9.0\",\"type\":\"m\"},{\"path\":[\"_array\",\"floatVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"10.0\",\"type\":\"m\"},{\"path\":[\"_array\",\"arrayIntegerVar\",\"0\"],\"_t\":\"Fragment\",\"jsonPayload\":\"10\",\"type\":\"m\"},{\"path\":[\"_array\",\"setStringVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"[\\\"_set\\\",\\\"string20\\\"]\",\"type\":\"m\"},{\"path\":[\"_array\",\"stringEnumVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"null\",\"type\":\"m\"},{\"path\":[\"_array\",\"mapBeanVar\",\"key1\",\"stringVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"\\\"string21\\\"\",\"type\":\"m\"},{\"path\":[\"_array\",\"mapBeanVar\",\"key1\",\"arrayStringVar\",\"1\"],\"_t\":\"Fragment\",\"jsonPayload\":null,\"type\":\"r\"},{\"path\":[\"_array\",\"mapBeanVar\",\"key1\",\"mapStringVar\",\"key_a\"],\"_t\":\"Fragment\",\"jsonPayload\":null,\"type\":\"r\"},{\"path\":[\"_array\",\"mapBeanVar\",\"key0\"],\"_t\":\"Fragment\",\"jsonPayload\":null,\"type\":\"r\"},{\"path\":[\"_array\",\"mapBeanVar\",\"key2\"],\"_t\":\"Fragment\",\"jsonPayload\":\"{\\\"stringVar\\\":\\\"string20\\\",\\\"_t\\\":\\\"TestBean2\\\",\\\"arrayStringVar\\\":[\\\"_array\\\",\\\"stringc\\\",\\\"stringc\\\",\\\"stringd\\\"],\\\"mapStringVar\\\":[\\\"_map\\\",[\\\"key_c\\\",\\\"value_c\\\"],[\\\"key_b\\\",\\\"value_b\\\"]]}\",\"type\":\"c\"},{\"path\":[\"_array\",\"arrayBooleanVar\",\"0\"],\"_t\":\"Fragment\",\"jsonPayload\":\"false\",\"type\":\"m\"},{\"path\":[\"_array\",\"setBooleanVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"[\\\"_set\\\",false]\",\"type\":\"m\"},{\"path\":[\"_array\",\"arrayStringVar\",\"0\"],\"_t\":\"Fragment\",\"jsonPayload\":\"\\\"string18\\\"\",\"type\":\"m\"},{\"path\":[\"_array\",\"beanVar3\",\"standardEnumVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"null\",\"type\":\"m\"},{\"path\":[\"_array\",\"beanVar3\",\"stringVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"null\",\"type\":\"m\"},{\"path\":[\"_array\",\"beanVar3\",\"longVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"null\",\"type\":\"m\"},{\"path\":[\"_array\",\"beanVar3\",\"doubleVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"null\",\"type\":\"m\"},{\"path\":[\"_array\",\"beanVar3\",\"floatVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"null\",\"type\":\"m\"},{\"path\":[\"_array\",\"beanVar3\",\"boolVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"null\",\"type\":\"m\"},{\"path\":[\"_array\",\"beanVar3\",\"intVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"null\",\"type\":\"m\"},{\"path\":[\"_array\",\"beanVar3\",\"stringEnumVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"null\",\"type\":\"m\"},{\"path\":[\"_array\",\"beanVar3\",\"integerEnumVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"null\",\"type\":\"m\"},{\"path\":[\"_array\",\"arrayDoubleVar\",\"0\"],\"_t\":\"Fragment\",\"jsonPayload\":\"14.0\",\"type\":\"m\"},{\"path\":[\"_array\",\"beanVar2\",\"standardEnumVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"\\\"ONE\\\"\",\"type\":\"m\"},{\"path\":[\"_array\",\"beanVar2\",\"stringVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"\\\"5string\\\"\",\"type\":\"m\"},{\"path\":[\"_array\",\"beanVar2\",\"longVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"2\",\"type\":\"m\"},{\"path\":[\"_array\",\"beanVar2\",\"doubleVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"3.0\",\"type\":\"m\"},{\"path\":[\"_array\",\"beanVar2\",\"floatVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"4.0\",\"type\":\"m\"},{\"path\":[\"_array\",\"beanVar2\",\"boolVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"true\",\"type\":\"m\"},{\"path\":[\"_array\",\"beanVar2\",\"intVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"1\",\"type\":\"m\"},{\"path\":[\"_array\",\"beanVar2\",\"stringEnumVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"\\\"tHree\\\"\",\"type\":\"m\"},{\"path\":[\"_array\",\"beanVar2\",\"integerEnumVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"2\",\"type\":\"m\"},{\"path\":[\"_array\",\"integerEnumVar\"],\"_t\":\"Fragment\",\"jsonPayload\":\"null\",\"type\":\"m\"}]}";


        const fragmentList = deserialise(fragmentListJson);


        // fragmentList.fragments.forEach( (f:any) => {
        //     console.log("FRAG: ", f.type, f.path, f.jsonPayload);
        // })



        const bean0 = deserialise(bean0Json);
        const bean1 = deserialise(bean1Json);
        const bean0Merge = mergeFragments(bean0, fragmentList);

        const bean1Fragments = fragmentalise(bean1, bean0Merge);

        //fragmentToString(bean1Fragments);
        
        expect(bean1Fragments.fragments.length === 0).to.be.true;


    });


    it("beans from server", () => {

        const bean0Json = "{\"longVar\":7,\"boolVar\":false,\"intVar\":6,\"arrayLongVar\":[\"_array\",13,14],\"arrayFloatVar\":[\"_array\",17.0,18.0],\"mapStringVar\":[\"_map\",[\"key1\",\"value1\"],[\"key0\",\"value0\"]],\"setLongVar\":[\"_set\",13,14],\"setFloatVar\":[\"_set\",18.0,17.0],\"beanVar\":{\"standardEnumVar\":\"ONE\",\"stringVar\":\"5string\",\"longVar\":2,\"doubleVar\":3.0,\"floatVar\":4.0,\"_t\":\"TestBean1\",\"boolVar\":true,\"intVar\":1,\"stringEnumVar\":\"tHree\",\"integerEnumVar\":2},\"arrayBeanVar0\":[\"_array\",{\"stringVar\":\"string21\",\"_t\":\"TestBean2\",\"arrayStringVar\":[\"_array\",\"stringa\",\"stringb\"],\"mapStringVar\":[\"_map\",[\"key_b\",\"value_b\"],[\"key_a\",\"value_a\"]]},{\"stringVar\":\"string22\",\"_t\":\"TestBean2\",\"arrayStringVar\":[\"_array\",\"stringa\",\"stringc\",\"stringd\"],\"mapStringVar\":[\"_map\",[\"key_b\",\"value_b\"],[\"key_a\",\"value_a\"]]}],\"arrayBeanVar1\":[\"_array\",{\"stringVar\":\"string21\",\"_t\":\"TestBean2\",\"arrayStringVar\":[\"_array\",\"stringa\",\"stringb\"],\"mapStringVar\":[\"_map\",[\"key_b\",\"value_b\"],[\"key_a\",\"value_a\"]]}],\"setIntegerVar\":[\"_set\",11,12],\"setDoubleVar\":[\"_set\",16.0,15.0],\"standardEnumVar\":\"ONE\",\"stringVar\":\"10string\",\"doubleVar\":8.0,\"floatVar\":9.0,\"arrayIntegerVar\":[\"_array\",11,12],\"setStringVar\":[\"_set\",\"string20\",\"string19\"],\"stringEnumVar\":\"tHree\",\"mapBeanVar\":[\"_map\",[\"key1\",{\"stringVar\":\"string22\",\"_t\":\"TestBean2\",\"arrayStringVar\":[\"_array\",\"stringa\",\"stringc\",\"stringd\"],\"mapStringVar\":[\"_map\",[\"key_b\",\"value_b\"],[\"key_a\",\"value_a\"]]}],[\"key0\",{\"stringVar\":\"string21\",\"_t\":\"TestBean2\",\"arrayStringVar\":[\"_array\",\"stringa\",\"stringb\"],\"mapStringVar\":[\"_map\",[\"key_b\",\"value_b\"],[\"key_a\",\"value_a\"]]}]],\"arrayBooleanVar\":[\"_array\",true,false],\"setBooleanVar\":[\"_set\",false,true],\"_t\":\"TestBean0\",\"arrayStringVar\":[\"_array\",\"string19\",\"string20\"],\"beanVar3\":{\"standardEnumVar\":\"ONE\",\"stringVar\":\"5string\",\"longVar\":2,\"doubleVar\":3.0,\"floatVar\":4.0,\"_t\":\"TestBean1\",\"boolVar\":true,\"intVar\":1,\"stringEnumVar\":\"tHree\",\"integerEnumVar\":2},\"arrayDoubleVar\":[\"_array\",15.0,16.0],\"beanVar2\":{\"standardEnumVar\":null,\"stringVar\":null,\"longVar\":null,\"doubleVar\":null,\"floatVar\":null,\"_t\":\"TestBean1\",\"boolVar\":null,\"intVar\":null,\"stringEnumVar\":null,\"integerEnumVar\":null},\"integerEnumVar\":2}";
        const bean1Json = "{\"longVar\":8,\"boolVar\":true,\"intVar\":7,\"arrayLongVar\":[\"_array\",12,14],\"arrayFloatVar\":[\"_array\",16.0,18.0],\"mapStringVar\":[\"_map\",[\"key1\",\"value1\"],[\"key2\",\"value2\"]],\"setLongVar\":[\"_set\",14],\"setFloatVar\":[\"_set\",16.0,18.0],\"beanVar\":{\"standardEnumVar\":\"TWO\",\"stringVar\":\"6string\",\"longVar\":3,\"doubleVar\":4.0,\"floatVar\":5.0,\"_t\":\"TestBean1\",\"boolVar\":false,\"intVar\":2,\"stringEnumVar\":\"oNe\",\"integerEnumVar\":3},\"arrayBeanVar0\":[\"_array\",{\"stringVar\":\"string20\",\"_t\":\"TestBean2\",\"arrayStringVar\":[\"_array\",\"stringc\",\"stringc\",\"stringd\"],\"mapStringVar\":[\"_map\",[\"key_c\",\"value_c\"],[\"key_b\",\"value_b\"]]}],\"arrayBeanVar1\":[\"_array\",{\"stringVar\":\"string21\",\"_t\":\"TestBean2\",\"arrayStringVar\":[\"_array\",\"stringa\"],\"mapStringVar\":[\"_map\",[\"key_b\",\"value_b\"]]},{\"stringVar\":\"string21\",\"_t\":\"TestBean2\",\"arrayStringVar\":[\"_array\",\"stringa\"],\"mapStringVar\":[\"_map\",[\"key_b\",\"value_b\"]]}],\"setIntegerVar\":[\"_set\",12],\"setDoubleVar\":[\"_set\",16.0,15.0],\"standardEnumVar\":null,\"stringVar\":\"11string\",\"doubleVar\":9.0,\"floatVar\":10.0,\"arrayIntegerVar\":[\"_array\",10,12],\"setStringVar\":[\"_set\",\"string20\"],\"stringEnumVar\":null,\"mapBeanVar\":[\"_map\",[\"key1\",{\"stringVar\":\"string21\",\"_t\":\"TestBean2\",\"arrayStringVar\":[\"_array\",\"stringa\"],\"mapStringVar\":[\"_map\",[\"key_b\",\"value_b\"]]}],[\"key2\",{\"stringVar\":\"string20\",\"_t\":\"TestBean2\",\"arrayStringVar\":[\"_array\",\"stringc\",\"stringc\",\"stringd\"],\"mapStringVar\":[\"_map\",[\"key_c\",\"value_c\"],[\"key_b\",\"value_b\"]]}]],\"arrayBooleanVar\":[\"_array\",false,false],\"setBooleanVar\":[\"_set\",false],\"_t\":\"TestBean0\",\"arrayStringVar\":[\"_array\",\"string18\",\"string20\"],\"beanVar3\":{\"standardEnumVar\":null,\"stringVar\":null,\"longVar\":null,\"doubleVar\":null,\"floatVar\":null,\"_t\":\"TestBean1\",\"boolVar\":null,\"intVar\":null,\"stringEnumVar\":null,\"integerEnumVar\":null},\"arrayDoubleVar\":[\"_array\",14.0,16.0],\"beanVar2\":{\"standardEnumVar\":\"ONE\",\"stringVar\":\"5string\",\"longVar\":2,\"doubleVar\":3.0,\"floatVar\":4.0,\"_t\":\"TestBean1\",\"boolVar\":true,\"intVar\":1,\"stringEnumVar\":\"tHree\",\"integerEnumVar\":2},\"integerEnumVar\":null}";
        

        const bean0 = deserialise(bean0Json);
        const bean1 = deserialise(bean1Json);

        console.log("BEAN0", serialise(bean0));
        console.log("BEAN1", serialise(bean1));

        const beanFragments = fragmentalise(bean0, bean1);

        //console.log("FRAGMENTS", serialise(beanFragments));
        beanFragments;


    });





});